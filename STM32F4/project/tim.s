TIM_BASE					EQU 0x40000400
RCC_APB1_ENR_TIM			EQU 0x01


RCC_BASE					EQU 0x40023800

RCC_CFGR_OFFSET				EQU 0x08
RCC_AHB1_ENR_OFFSET			EQU 0x30
RCC_APB1_ENR_OFFSET			EQU 0x40	



TIMx_CR1_OFFSET				EQU 0x00
TIMx_CNT_OFFSET				EQU 0x24
TIMx_CCR1_OFFSET			EQU 0x34

TIMx_CR1_OPM				EQU 0x03
TIMx_CR1_CEN				EQU 0x00

	
	AREA FUNCTION,CODE,READONLY
		EXPORT TIM_INIT
		EXPORT TIM
			
TIM_INIT	PROC
		
		PUSH {R3-R4, LR}
		
		LDR R3, =RCC_BASE
		
		LDR R4, [R3, #RCC_APB1_ENR_OFFSET]		;піключаємо тактовий сигнал
		ORR r4, #(1 << RCC_APB1_ENR_TIM)
		STR R4, [R3, #RCC_APB1_ENR_OFFSET]
		

		
		//LDR R4, [R3, #TIMx_CR1_OFFSET]			;включаємо лічильник
		//ORR R4, #(1 << TIMx_CR1_CEN)
		//STR R4, [R3, #TIMx_CR1_OFFSET]
		
		
		
		
		POP {R3-R4, PC}
		ENDP
		ALIGN
			
			
			
TIM	PROC
		
		LDR R0, =TIM_BASE
		LDR R0, [R0, #TIMx_CNT_OFFSET]
		
		BX LR
		ENDP
		ALIGN
			
			
		END